# kms-generic-helm-charts

## Deployment on minikube

### Minikube setup

1. Start Minikube

```shell
minikube start --addons=ingress,ingress-dns
```

2. Configure the `ingress-dns` addon by following the [documentation](https://minikube.sigs.k8s.io/docs/handbook/addons/ingress-dns/).

  <details close>
  <summary>For Linux, the configuration depends on your systemâ€™s DNS setup (expand to read more)</summary>

To find the DNS setup, run `head /etc/resolv.conf`:

- Mentions resolvconf: follow the [Linux OS with resolvconf](https://minikube.sigs.k8s.io/docs/handbook/addons/ingress-dns/#linux-os-with-resolvconf) instructions
- Contains `# Generated by NetworkManager`: follow the [Linux OS with Network Manager](https://minikube.sigs.k8s.io/docs/handbook/addons/ingress-dns/#linux-os-with-network-manager) instructions
- Contains `# This is /run/systemd/resolve/stub-resolv.conf managed by man:systemd-resolved(8).`: run the following commands (systemd-resolved is not covered by the minikube documentation):

    ```shell
    sudo mkdir /etc/systemd/resolved.conf.d
    sudo tee /etc/systemd/resolved.conf.d/minikube.conf << EOF
    [Resolve]
    DNS=$(minikube ip)
    Domains=~test
    EOF
    sudo systemctl restart systemd-resolved
    ```
  </details>


### Deployment

```shell
helm -n kms upgrade --install --create-namespace kms ./ -f ./example-values/minikube.yaml
```

### Accessing services

|               | Through ingress        | From other pods                         |
|---------------|------------------------|-----------------------------------------|
| KMS           | http://kms.local/kms/  | http://kms-kms-generic-helm-charts:8000 |
| Elasticsearch | http://kms.local/es/   | http://kms-elasticsearch:9200           |
